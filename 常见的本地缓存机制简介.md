
# 常见的本地缓存机制简介
## 一、本地缓存的的四个主线
- 可存储多种数据
- 可设置最大缓存空间
- 可设置数据过期时间
- 可设置最多缓存文件个数

## 二、存储数据
- 可存储多种数据类型：String、Json、序列化数据、byte[]、Drawable、Bitmap
- 一般将存储路径定为 app 的根目录，这样不 root 的话，就获取不到数据，比较安全，且 app 卸载时也会跟着一起删除

## 三、最大缓存空间的实现
1. file 的 setLastModified() 方法可以设置文件的最后修改时间
2. file 的 lastModified() 方法可以获取文件的最后修改时间
3. 初始化时，将 Cache 文件夹中的所有文件遍历出来，存为 Map<File,modifiedTime> 形式，作为 file 维护站点；同时在遍历中叠加 file 的所占空间，得到当前缓存已使用的空间
4. 在写入数据完成后，刷新 file 的最后修改时间；如果当前的缓存已经超出最大缓存空间限制，则开始遍历 map，将最后修改时间与当前时间对比，删除最长时间未使用的的文件，直至当前缓存在最大缓存空间限制内才停止删除！同时注意更新 map

## 四、数据过期时间的实现
1. 在写入数据时，将写入时间与数据过期时间一并作为数据写入文件（比如将时间以特定的格式拼接在数据头部）
2. 读取文件时，以指定的规则，检测数据的头部是否含有时间，有则说明文件设置了数据过期时间，将读取到的写入时间+数据过期时间与当前时间做对比，如果大于当前时间，则不使用数据，删除文件；如果没有设置数据过期时间，则不做处理

## 五、最多缓存文件个数的实现
一般来说，缓存都是使用最大缓存空间就足够了，但是多了解一下还是没错的，我们还是讲一下最多缓存文件个数的实现吧~~（原理与上述最大缓存空间的实现类似）
1. 初始化 file 维护站点 map 时，同时统计下 file 的个数
2. 在写入数据完成后，刷新 file 的最后修改时间；如果当前缓存已经超出最大可缓存个数，则按照删除最长时间未使用的文件的规则来删除文件，直至 file 个数小于等于最大可缓存个数，更新 map

